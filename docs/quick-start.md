# Quick Start Guide

## Installation

### From Source
```bash
go install github.com/tesh254/migraine@latest
```

### Build from Repository
```bash
git clone https://github.com/tesh254/migraine.git
cd migraine
go build -o migraine .
# Optionally install globally: sudo install migraine /usr/local/bin/migraine
```

## Your First Workflow

### 1. Create a New Workflow
```bash
migraine workflow init hello-world -d "My first workflow"
```

This creates `./workflows/hello-world.yaml` with a fully documented template.

### 2. Examine the Generated File
The command creates a file like this:

```yaml
# hello-world.yaml - generated by Migraine
# 
# This is a YAML workflow definition for Migraine.
# 
# Fields:
# - name: The name of the workflow (required)
# - description: A brief description of what this workflow does (optional)
# - pre_checks: Commands to run before executing the main steps (optional)
# - steps: The main commands to execute in the workflow (required)
# - actions: Additional commands that can be run independently (optional)
# - config: Configuration options for the workflow (optional)
# - use_vault: Whether to use the vault for variable resolution (default: false)

name: hello-world
description: My first workflow

# Pre-checks are commands that run before the main workflow steps.
# They are typically used for validation, checking if required tools are available, etc.
# If any pre-check fails, the workflow execution stops.
pre_checks:
  # - command: "which git"  # Check if git is available
  #   description: "Verify git is installed"

# Steps are the main commands that make up the workflow.
# They will be executed in the order they appear.
steps:
  # Example step
  - command: "echo 'Hello from workflow hello-world!'" 
    description: "Example step that prints a message"
  # Add more steps as needed

# Actions are optional commands that can be run independently of the main workflow.
# They are typically used for cleanup, deployment, or other operations.
actions:
  # Example action
  # cleanup:
  #   command: "rm -rf ./temp"
  #   description: "Clean up temporary files"

# Configuration options for the workflow
config:
  # Variables that can be used in the workflow
  # These will be prompted for when running the workflow if not provided
  variables:
    # project_name:
    #   - "slugify"  # Apply slugify transformation to the variable value
  # Whether to store variables in the workflow (true) or prompt for them each time (false)
  store_variables: false

# Whether to use the vault for variable resolution
# If true, variables will be resolved from the vault
# If false, variables will be resolved from environment files or prompted
use_vault: false
```

### 3. Modify the Workflow (Optional)
Edit `./workflows/hello-world.yaml` to customize it for your needs.

### 4. Validate the Workflow
```bash
migraine workflow validate workflows/hello-world.yaml
```

### 5. Run the Workflow
```bash
migraine workflow run hello-world
```

## Common Use Cases

### Development Environment Setup
```bash
# Create a setup workflow
migraine workflow init dev-setup -d "Development environment setup"

# Edit the generated file to include your setup commands
```

### CI/CD Pipeline
```bash
# Create a build workflow
migraine workflow init build -d "Build and test application"
```

### Deployment
```bash
# Create a deployment workflow
migraine workflow init deploy -d "Deploy to production"
```

## Variable Management

### Security Notice
⚠️ **IMPORTANT**: The vault currently stores variables in an unencrypted SQLite database. While variables are stored locally, they are not encrypted at rest. We are actively working on adding encryption support in an upcoming release. For now, we recommend avoiding storing highly sensitive information like production API keys in the vault until encryption is implemented.

### 1. Store a Variable in the Vault
```bash
migraine vars set api_key "your-api-key-here"
```

### 2. List Variables
```bash
migraine vars list
```

### 3. Use Variables in Workflows
```yaml
# In your workflow file
use_vault: true  # This enables vault variable resolution

steps:
  - command: "curl -H 'Authorization: Bearer {{api_key}}' https://api.example.com"
    description: "Call API with stored key"
```

### 4. Run with Specific Variables
```bash
migraine workflow run my-workflow -v env=production -v server=prod-server
```

### 5. Practical Examples with Expected Output

#### Example: Setting and Using Variables
```bash
# Store a variable
$ migraine vars set project_name "my-awesome-project"
Variable 'project_name' stored successfully with scope 'global'

# List all variables
$ migraine vars list
KEY             SCOPE      WORKFLOW    VALUE
project_name    global                 my-awesome-project

# Create a workflow that uses the variable
# (workflows/greet.yaml)
name: greet
use_vault: true

steps:
  - command: "echo 'Hello from {{project_name}}!'"
    description: "Greet with project name"

# Run the workflow
$ migraine workflow run greet
[Executing] Greet with project name
Hello from my-awesome-project!

# Run with override variable
$ migraine workflow run greet -v project_name="different-project"
[Executing] Greet with project name
Hello from different-project!
```

#### Example: Multi-Environment Variables
```bash
# Set different environment variables
$ migraine vars set api_url "https://dev-api.example.com" -s project
$ migraine vars set api_url "https://staging-api.example.com" -s project

# Workflow file (workflows/test-api.yaml)
name: test-api
use_vault: true

steps:
  - command: "curl -X GET {{api_url}}/health"
    description: "Test API health endpoint"

# Run with the project-scoped variable
$ migraine workflow run test-api
[Executing] Test API health endpoint
{"status": "healthy", "timestamp": "2024-01-15T10:30:45Z"}
```

## Advanced Quick Examples

### Multi-Step Deployment Workflow
```yaml
name: deploy-app
description: Deploy application with validation and rollback

pre_checks:
  - command: "which rsync"
    description: "Verify rsync is available"
  - command: "ssh -q {{server}} exit"
    description: "Test server connectivity"

steps:
  - command: "npm run build"
    description: "Build the application"
  - command: "tar -czf app.tar.gz dist/"
    description: "Package for deployment"
  - command: "rsync -av app.tar.gz {{user}}@{{server}}:/tmp/"
    description: "Upload package to server"
  - command: "ssh {{user}}@{{server}} 'cd /opt/app && tar -xzf /tmp/app.tar.gz'"
    description: "Extract on server"

actions:
  rollback:
    command: "ssh {{user}}@{{server}} 'cd /opt/app && git checkout HEAD~1'"
    description: "Rollback to previous version"
  cleanup:
    command: "rm -f app.tar.gz && ssh {{user}}@{{server}} 'rm -f /tmp/app.tar.gz'"
    description: "Clean up temporary files"

config:
  store_variables: false

use_vault: true
```

## Project Structure

After setting up workflows, your project will look like:

```
my-project/
├── migraine.yml              # (Optional) Project configuration
├── workflows/                # Workflow directory
│   ├── hello-world.yaml      # Individual workflow files
│   ├── dev-setup.yaml
│   └── deploy.yaml
├── .env                      # (Optional) Environment variables
├── .gitignore               # Add workflows/ if needed
└── src/                     # Your project files
```

## Useful Commands

```bash
# List all workflows
migraine workflow list

# Show workflow details
migraine workflow info hello-world

# Create a new workflow
migraine workflow init workflow-name -d "Description"

# Validate a workflow file
migraine workflow validate workflows/workflow-name.yaml

# Run a workflow
migraine workflow run workflow-name

# Set a variable in the vault
migraine vars set key value

# List all variables
migraine vars list

# Get a specific variable
migraine vars get key

# Show version information
migraine version
```

## Troubleshooting Quick Tips

### Workflow Not Found
- Check that the workflow file is in `./workflows/` or current directory
- Verify the file has `.yaml` or `.yml` extension
- Ensure the workflow name matches the file name or `name` field

### Variables Not Resolving
- Check that `use_vault: true` in the workflow if using vault variables
- Verify variable is set: `migraine vars get variable_name`
- Check variable scope: global, project, or workflow

### Pre-check Failures
- Examine the specific command that failed
- Verify all dependencies are installed
- Check that required files/directories exist

## Next Steps

1. **Create your first meaningful workflow** for your project
2. **Set up environment-specific variables** in the vault
3. **Organize workflows** in the `./workflows/` directory
4. **Add pre-checks** to validate prerequisites
5. **Use actions** for cleanup and rollback operations
6. **Document your workflows** with clear descriptions

For more detailed information, check out the other documentation files in this directory.